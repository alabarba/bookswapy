"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var convector_core_1 = require("@worldsibu/convector-core");
var convector_common_fabric_helper_1 = require("@worldsibu/convector-common-fabric-helper");
var FabricControllerAdapter = (function (_super) {
    tslib_1.__extends(FabricControllerAdapter, _super);
    function FabricControllerAdapter(config) {
        var _this = _super.call(this, config) || this;
        _this.config = config;
        return _this;
    }
    FabricControllerAdapter.prototype.invoke = function (controller, name, config) {
        var args = [];
        for (var _i = 3; _i < arguments.length; _i++) {
            args[_i - 3] = arguments[_i];
        }
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var err_1, errors;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4, _super.prototype.invoke.apply(this, [controller + "_" + name, this.config.chaincode, config].concat(args))];
                    case 1: return [2, _a.sent()];
                    case 2:
                        err_1 = _a.sent();
                        if (!err_1.responses) {
                            throw err_1;
                        }
                        errors = void 0;
                        try {
                            errors = err_1.responses
                                .map(function (response) { return ({
                                response: response,
                                error: JSON.parse(response.message.replace(/^.+\{/, '{'))
                            }); });
                        }
                        catch (e) {
                            throw new convector_core_1.ClientResponseError(err_1.responses.map(function (error) { return ({
                                error: error,
                                response: error
                            }); }));
                        }
                        throw new convector_core_1.ClientResponseError(errors);
                    case 3: return [2];
                }
            });
        });
    };
    FabricControllerAdapter.prototype.query = function (controller, name, config) {
        var args = [];
        for (var _i = 3; _i < arguments.length; _i++) {
            args[_i - 3] = arguments[_i];
        }
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                return [2, _super.prototype.query.apply(this, [controller + "_" + name, this.config.chaincode, config].concat(args))];
            });
        });
    };
    return FabricControllerAdapter;
}(convector_common_fabric_helper_1.ClientHelper));
exports.FabricControllerAdapter = FabricControllerAdapter;
//# sourceMappingURL=fabric.controller-adapter.js.map